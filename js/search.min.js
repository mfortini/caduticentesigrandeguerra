(function(){function h(k,l){var m=$.grep(k,function(p,o){return l.indexOf(p)>=0});return m}function a(m){var l="";l+='<a href="'+m.url+'" class="list-group-item">';l+='<div class="panel panel-default">';l+='<div class="panel-heading">';if(m.state!="open"){l+="<strike>"}l+="<h4>"+m.title+"</h4>";if(m.state!="open"){l+="</strike>"}l+="</div>";l+='<div class="panel-body">';l+="<small>";l+='<p class="list-group-item-text">'+m.content.substring(0,250)+"...</p>";l+='<p class="list-group-item-text">'+m.date+"</p>";l+="</small>";l+="</div>";l+='<div class="panel-footer">';var n=m.label;var k=h(n,e);l+=k.join("|");l+="</div>";l+="</div>";l+="</a>";return l}function c(o,l,p){var k=$("#search-results");if(o.length){var m="";var r=[];for(var n=0;n<o.length;n++){var q=l[o[n].ref];r.push(q)}r=r.sort(function(t,s){return -1*(parseInt(t.created_at)-parseInt(s.created_at))});m+='<div class="panel-group">';for(var n=0;n<r.length;n++){var q=r[n];if(q.state=="open"){m+=a(q)}}m+="</div>";m+='<div class="panel-group">';for(var n=0;n<r.length;n++){var q=r[n];if(q.state!="open"){m+=a(q)}}m+="</div>";k.html(m)}else{k.html("<li>Nessuna segnalazione trovata</li>")}}function b(n,l){var k=$("#search-results");if(Object.keys(l).length){var m="";var o=[];$.each(l,function(p,q){o.push(q)});o=o.sort(function(q,p){return -1*(parseInt(q.created_at)-parseInt(p.created_at))});m+='<div class="panel-group">';$.each(o,function(p,q){if(!n||$.inArray(n,q.label.toLowerCase().split(","))>=0){if(q.state=="open"){m+=a(q)}}});m+="</div>";m+='<div class="panel-group">';$.each(o,function(p,q){if(!n||$.inArray(n,q.label.toLowerCase().split(","))>=0){if(q.state!="open"){m+=a(q)}}});m+="</div>";k.html(m)}else{k.html("<li>Nessuna segnalazione trovata</li>")}}function i(l){var m=window.location.search.substring(1);var n=m.split("&");for(var k=0;k<n.length;k++){var o=n[k].split("=");if(o[0]===l){return decodeURIComponent(o[1].replace(/\+/g,"%20"))}}}function f(o,m,n){NProgress.start();if(o){for(var l in window.store){if(!m||$.inArray(m,window.store[l].label.toLowerCase().split(","))>=0){j.addDoc({id:l,title:window.store[l].title,content:window.store[l].content,state:window.store[l].state,date:window.store[l].date,label:window.store[l].label})}}var k=j.search(o,{fields:{title:{boost:10}},bool:"OR"});c(k,window.store,n)}else{b(m,window.store,n)}NProgress.done()}var e=["Alloggi","acquisto solidale","Bambini","Bollettino","Bufale","Contatti","Donazioni","Fabbisogni","Notizie Utili","Ospitalita animali","Raccolte Fondi"];var d=i("query");var g=i("label");if(g){document.getElementById("labelchoice").value=g;g=g.toLowerCase()}NProgress.start();if(d){document.getElementById("search-box").setAttribute("value",d)}var j=elasticlunr(function(){this.use(elasticlunr.it);this.addField("title",{boost:10});this.addField("label");this.addField("content");this.addField("state");this.setRef("id")});setTimeout(function(){if(window.store){f(d,g,e)}},0)})();document.getElementById("search-box").onkeydown=function(a){if(a.keyCode==13){NProgress.start()}};